{% extends "layout.html" %}

{% block main %}

<div class="w3-half w3-container">
    <div id="tsne_plot"></div>
    <div>
        {% if join == 'left' %}
        <a href="{{url_for('w2v_page', slug=slug, trial=trial, join='inner')}}" class="w3-btn w3-black">Exclude</a>
        {% else %}
        <a href="{{url_for('w2v_page', slug=slug, trial=trial, join='left')}}" class="w3-btn w3-black">Include</a>    
        {% endif %}
    </div>
</div>

{% endblock %}

{% block code %}

{% set max_pc = coords.pc_id.max() %}
{% set min_pc = coords.pc_id.min() %}
var traces  = []
{% for pc_id in range(min_pc, max_pc+1) %}
{% set pc = coords.loc[coords.pc_id == pc_id] %}
var sizes = {{ pc.token_norm_count.tolist() | tojson | safe }}
traces.push({
    x: {{ pc.tsne_x.tolist() | tojson | safe }},
    y: {{ pc.tsne_y.tolist() | tojson | safe }},
    text: {{ pc.token_str.tolist() | tojson | safe }},
    type: 'scatter',
    mode: 'text+markers',
    name: 'PC'+{{pc_id+1}},
    textposition: 'top center',
    textfont: {
        family: 'Arial, sans-serif',
        size: sizes
        /* color: 'Grays' */
    },
    marker: { 
        size: sizes,
        sizemode: 'diameter'
    },

})
{% endfor %}

var layout = {
    hovermode: 'closest',
    width: 1200,
    height: 1200,
    hoverinfo: 'none',
    legend: {
        orientation: 'v'
    }
}
Plotly.newPlot('tsne_plot', traces, layout)

{% endblock %}