#! /usr/bin/env python3

from PoloConfig import PoloConfig
from PoloMallet import PoloMallet
from PoloCorpus import PoloCorpus

if __name__ == '__main__':
    
    print("Welcome to Polo")

    print("Import config")
    mc = PoloConfig()
    mc.read_ini('config.ini')
    trials = mc.get_trial_names()

    print("Pick a trial")
    print(trials)


    print("Initialize corpus")
    corpus = PoloCorpus(mc)
    corpus.cache_mode = True

    print("Importing stopwords")
    corpus.import_table_stopword(use_nltk=True)

    print("Importing doc")
    corpus.import_table_doc()

    print("Importing doctoken and token")
    corpus.add_tables_doctoken_and_token()

    print("Importing bigrams")
    corpus.get_ngrams(n=2)

    mc.import_ini(trials[0])

    print("Initializing")
    m = PoloMallet(mc)

    print('Importing corpus')
    m.mallet_import()

    print('Training model')
    m.mallet_train()

    print("Putting data into database")
    m.tables_to_db()

    print("Adding diagnostics tables")
    m.add_diagnostics()

    print("Adding doc table with topic entropy")
    m.add_topic_entropy()

    print("Adding topicpair table")
    m.create_table_topicpair()

    print("Cleaning up")
    m.del_mallet_files()

    print("Done with", m.config.trial_name)
